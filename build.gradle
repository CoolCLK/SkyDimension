buildscript {
    repositories {
        maven { url = "https://maven.minecraftforge.net" }
        mavenCentral()
    }
    dependencies {
        classpath group: "net.minecraftforge.gradle", name: "ForgeGradle", version: forge_gradle_version, changing: true
    }
}
apply plugin: "net.minecraftforge.gradle"

version = mod_version
group = mod_group + "." + mod_id
archivesBaseName = mod_id

java.toolchain.languageVersion = JavaLanguageVersion.of(8)

repositories {
    maven { url = "https://maven.minecraftforge.net" }
}

dependencies {
    minecraft "net.minecraftforge:forge:${mod_minecraft_version}-${forge_dependency_version}"
}

minecraft {
    mappings channel: "official", version: mod_minecraft_version
    runs {
        client {
            workingDirectory project.file("run")
            property "forge.logging.markers", "REGISTRIES"
            property "forge.logging.console.level", "debug"
            mods {
                "${mod_id}" {
                    source sourceSets.main
                }
            }
        }
        server {
            workingDirectory project.file("run")
            property "forge.logging.markers", "REGISTRIES"
            property "forge.logging.console.level", "debug"
            mods {
                "${mod_id}" {
                    source sourceSets.main
                }
            }
        }
        data {
            workingDirectory project.file("run")
            property "forge.logging.markers", "REGISTRIES"
            property "forge.logging.console.level", "debug"
            args "--mod", mod_id, "--all", "--output", file("src/generated/resources/"), "--existing", file("src/main/resources/")
            mods {
                "${mod_id}" {
                    source sourceSets.main
                }
            }
        }
    }
}

sourceSets.main.resources { srcDir "src/generated/resources" }

jar {
    duplicatesStrategy = DuplicatesStrategy.EXCLUDE
    baseName mod_id + "-" + mod_minecraft_version
}

jar.finalizedBy("reobfJar")

processResources {
    from(sourceSets.main.resources.srcDirs) {
        include "mods.toml"
        expand "mod_id": mod_id, "mod_name": mod_name, "mod_license": mod_license, "mod_credits": mod_credits, "mod_description": mod_description, "mod_version": mod_version, "mod_minecraft_version": mod_minecraft_version, "mod_url": mod_url, "mod_update_url": mod_update_url, "mod_authors": mod_authors
    }

    from(sourceSets.main.resources.srcDirs) {
        exclude "mods.toml"
    }
}